<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="everywhere.com.mynetgear.ccvf2.user.mapper.search">
	<!-- 명소의 개수를 반환 -->
	<select id="getSpotCount" resultType="int">
		select count(*)
		from tbl_spot
		<if test="searchValue != null">
			where spot_name like '%'||#{searchValue, jdbcType=VARCHAR}||'%' 
			or spot_addr like '%'||#{searchValue, jdbcType=VARCHAR}||'%'
		</if>
	</select>
	
	<!-- 스케줄의 개수를 반환 -->
	<select id="getPlannerCount" parameterType="java.util.Map" resultType="int">
		select count(*)
		from tbl_planner
		where use_yn=#{use_yn}
		<if test="searchValue != null">
			and (title like '%'||#{searchValue, jdbcType=VARCHAR}||'%' 
			or memo like '%'||#{searchValue, jdbcType=VARCHAR}||'%')
		</if>
	</select>
	
	<!-- 명소의 리스트를 반환 -->
	<select id="getSpotList" resultType="everywhere.com.mynetgear.ccvf2.user.dto.search.SpotDtoExt">
		<![CDATA[
			select spot.rnum,
			      spot.spot_no,
			      spot.mem_no,
			      spot.country_code,
			      spot.city_code,
			      (select code_name from tbl_common_code where code=spot.city_code) city_name,
			      spot.spot_name,
			      spot.spot_type_code,
			      spot.mem_level_code,
			      spot.spot_note,
			      spot.attach_file,
			      spot.spot_addr,
			      spot.spot_lat,
			      spot.spot_long,
			      spot.total_star_score,
			      spot.count_star_score,
			      tbl_member.mem_name
			from 
			  (select rownum rnum, a.* from 
			    (select * from tbl_spot order by spot_name asc) a
			  ) spot, tbl_member
			where spot.rnum >= 1 and spot.rnum <= 30
			and tbl_member.mem_no = spot.mem_no
		]]>
	</select>
	
	<!-- 스케줄의 리스트를 반환 -->
	<select id="getPlannerList" parameterType="java.util.Map" resultType="everywhere.com.mynetgear.ccvf2.user.dto.planner.ItemDto">
		select * 
		from tbl_planner
	</select>
</mapper>